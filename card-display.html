<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../card-deck/card-deck.html">
<link rel="import" href="../update-data/update-data.html">
<link rel="import" href="../sortable-list/sortable-list.html">
<link rel="import" href="../iron-selector/iron-selector.html">
<link rel="import" href="../paper-fab/paper-fab.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">
<link rel="import" href="../polymer/polymer.html">
<!--
`<card-display cards="{{cards}}"></card-display>` displays card
@demo demo.html
-->

<dom-module id="card-display">
  <template>
    <style>
      paper-fab {
        position: absolute;
        background: gray;
      }
      .iron-selected paper-fab {
        background: red;
      }
    </style>
    
    <template is="dom-if" if="{{veiwable}}">
      <template is="dom-repeat" items="{{cards}}" as="card">
        <div style="float:left">
          <template is="dom-if" if="{{isCard(card,'deck')}}">
            <div style="margin: 5px 0" on-tap="openDeck"  data-index="{{index}}">
              <card-deck elevation="4" width="200" height="250" style="width:200px;height:250px;margin:12px 7px">
                <div style="width:200px;height:147px" data-index="{{index}}">
                  <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" style="pointer-events: none; display: block; width: 100%; height: 100%"><g class="style-scope iron-icon"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" class="style-scope iron-icon"></path></g></svg>
                </div><br />
                <h3 style="margin: 0; padding: 13px;">{{card.title}}</h3>
              </card-deck>
            </div>
          </template>
          <template is="dom-if" if="{{isCard(card,'card')}}">
            <paper-material elevation="4" style="margin:12px 7px;background:#fff;display:inline-block;width:200px;height:250px">
              <a href="{{card.url}}" target="_blank" style="text-decoration: initial;color: black"><div style="background-size:cover;background-position: center;display:inline-block;width:200px;height:147px;background-image:url({{card.image}});background-repeat: no-repeat;"></div></a><br />
              <a href="{{card.url}}" style="text-decoration: initial;color: black"><h3 style="margin: 0; padding: 13px;">{{card.title}}</h3></a>
              <a href="{{card.url}}" style="text-decoration: initial;color: black"><p style="margin: 0; padding: 0 13px;">{{card.data}}</p></a>
            </paper-material>
          </template>
        </div>
      </template>
    </template>
    <template is="dom-if" if="{{sortable}}">
      <sortable-list sort-me="{{cards}}" output="{{sortMe}}">
        <template is="dom-repeat" items="{{sortMe}}" as="card">
          <div style="float:left">
            <template is="dom-if" if="{{isCard(card,'deck')}}">
            <div style="margin: 5px 0">
                <card-deck elevation="4" width="200" height="250" style="width:200px;height:250px;margin:12px 7px">
                  <div style="width:200px;height:147px">
                    <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" class="style-scope iron-icon" style="pointer-events: none; display: block; width: 100%; height: 100%;"><g class="style-scope iron-icon"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" class="style-scope iron-icon"></path></g></svg>
                  </div><br />
                  <h3 style="margin: 0; padding: 13px;">{{card.title}}</h3>
                </card-deck>
              </div>
            </template>
            <template is="dom-if" if="{{isCard(card,'card')}}">
              <paper-material elevation="4" style="margin:12px 7px;background:#fff;display:inline-block;width:200px;height:250px">
                <a href="{{card.url}}" target="_blank" style="text-decoration: initial;color: black"><div style="background-size:cover;background-position: center;display:inline-block;width:200px;height:147px;background-image:url({{card.image}});background-repeat: no-repeat;"></div></a><br />
                <a href="{{card.url}}" style="text-decoration: initial;color: black"><h3 style="margin: 0; padding: 13px;">{{card.title}}</h3></a>
                <a href="{{card.url}}" style="text-decoration: initial;color: black"><p style="margin: 0; padding: 0 13px;">{{card.data}}</p></a>
              </paper-material>
            </template>
          </div>
        </template>
      </sortable-list>
      <update-data update="{{cards}}" data="{{sortMe}}"></update-data>
    </template>
    <template is="dom-if" if="{{selectable}}">
      <iron-selector multi selected-values="{{selected}}">
        <template is="dom-repeat" items="{{cards}}" as="card">
          <div style="float:left">
            <template is="dom-if" if="{{isCard(card,'deck')}}">
            <div style="margin: 5px 0">
                <card-deck elevation="4" width="200" height="250" style="width:200px;height:250px;margin:12px 7px">
                  <div style="width:200px;height:147px">
                    <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" class="style-scope iron-icon" style="pointer-events: none; display: block; width: 100%; height: 100%;"><g class="style-scope iron-icon"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" class="style-scope iron-icon"></path></g></svg>
                  </div><br />
                  <h3 style="margin: 0; padding: 13px;">{{card.title}}</h3>
                </card-deck>
              </div>
            </template>
            <template is="dom-if" if="{{isCard(card,'card')}}">
              <paper-material elevation="4" style="margin:12px 7px;background:#fff;display:inline-block;width:200px;height:250px">
                <div style="background-size:cover;background-position: center;display:inline-block;width:200px;height:147px;background-image:url({{card.image}});background-repeat: no-repeat;"></div><br />
                <h3 style="margin: 0; padding: 13px;">{{card.title}}</h3>
                <p style="margin: 0; padding: 0 13px;">{{card.data}}</p>
              </paper-material>
            </template>
            <paper-fab mini icon="done"></paper-fab>
          </div>
        </template>
      </iron-selector>
    </template>
    <template is="dom-if" if="{{pickable}}">
      <template is="dom-repeat" items="{{cards}}" as="card">
        <div style="float:left" on-tap="picked" data-index="{{index}}">
          <template is="dom-if" if="{{isCard(card,'deck')}}">
            <div style="margin: 5px 0">
              <card-deck elevation="4" width="200" height="250" style="width:200px;height:250px;margin:12px 7px">
                <div style="width:200px;height:147px">
                  <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" class="style-scope iron-icon" style="pointer-events: none; display: block; width: 100%; height: 100%;"><g class="style-scope iron-icon"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" class="style-scope iron-icon"></path></g></svg>
                </div><br />
                <h3 style="margin: 0; padding: 13px;">{{card.title}}</h3>
              </card-deck>
            </div>
          </template>
          <template is="dom-if" if="{{isCard(card,'card')}}">
            <paper-material elevation="4" style="margin:12px 7px;background:#fff;display:inline-block;width:200px;height:250px">
              <div style="background-size:cover;background-position: center;display:inline-block;width:200px;height:147px;background-image:url({{card.image}});background-repeat: no-repeat;"></div><br />
              <h3 style="margin: 0; padding: 13px;">{{card.title}}</h3>
              <p style="margin: 0; padding: 0 13px;">{{card.data}}</p>
            </paper-material>
          </template>
          <paper-fab mini icon="touch-app"></paper-fab>
        </div>
      </template>
    </template>
    <paper-dialog id="dialDeck">
      <template is="dom-if" if="{{deck}}">
        <card-display cards="{{deck}}"></card-display>
      </template>
    </paper-dialog>  
  </template>
</dom-module>
<script>
  Polymer({
    is: "card-display",
    properties: {
      cards: {notify: true},
      selected: {notify: true},
      selectable: {type: Boolean, value: false},
      sortable: {type: Boolean, value: false},
      pickable: {type: Boolean, value: false},
      veiwable: {type: Boolean, computed:"getVeiwable(selectable, pickable, sortable)"}
    },
    getVeiwable(selectable, pickable, sortable) {
      return !(selectable  || pickable || sortable)
    },
    isCard: function(card, isA){
      if (isA === "card") {
        return (card.url.split(":")[0] === "https" || card.url.split(":")[0] === "http")
      }
      if (isA === "deck") {
        return card.url.split(":")[0] === "deck"
      }
    },
    openDeck: function(e){
      function objectToArray(data) {
        var output = []
        if (data) {
          var keys = Object.keys(data)
          for (var i = 0; i < keys.length; i++) {
            if (typeof data[keys[i]] === 'object') {
              output.push(data[keys[i]])
            }
          }
        }
        return output
      }
      var selected
      if (e.target.parentElement.parentElement.hasOwnProperty("dataIndex")) {
        selected = e.target.parentElement.parentElement.dataIndex
      } else if (e.target.parentElement.hasOwnProperty("dataIndex")) {
        selected = e.target.parentElement.dataIndex
      } else if (e.target.hasOwnProperty("dataIndex")) {
        selected = e.target.dataIndex
      } 
      // get data
      this.deck = objectToArray(this.cards[selected].data) 
      this.$.dialDeck.open()

    },
    picked: function(e){
      var selected
      if (e.target.parentElement.parentElement.hasOwnProperty("dataIndex")) {
        selected = e.target.parentElement.parentElement.dataIndex
      } else if (e.target.parentElement.hasOwnProperty("dataIndex")) {
        selected = e.target.parentElement.dataIndex
      } else if (e.target.hasOwnProperty("dataIndex")) {
        selected = e.target.dataIndex
      } 
      this.fire("picked", selected)
    }
  })
</script>
